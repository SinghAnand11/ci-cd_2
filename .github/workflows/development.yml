name: CD_pipeline
on:
  workflow_run:
    workflows: ["CI pipeline"]
    types:
      - completed

  workflow_dispatch:
jobs:
deploy:
    machine:
      image: ubuntu-2004:current
    resource_class: medium
    steps:
      - run:
          name: Deploy API to Render
          command: |
            response=$(curl -s -w "%{http_code}" -o response.txt ${{ secrets.RENDER_DEPLOY_HOOK_URL }})
            response_code=${response:(-3)}
            if [ $response_code -eq 200 ]; then
              echo "Deployment successful!"
              cat response.txt  # Print the response body
            else
              echo "Deployment failed with response code: $response_code"
              cat response.txt  # Print the response body
              exit 1
            
